# Chronomancy Telegram Mini App\n\nüåÄ **A temporal exploration experience that transcends the limitations of traditional chat interfaces**\n\n> \"If Randonautica is to Ingress what Chronomancy will be to Pok√©mon Go\" - The Canon\n\n## Overview\n\nThe Chronomancy Mini App transforms the bot's temporal ping system into an immersive 3D experience within Telegram. Users can visualize time flows, configure their temporal windows, and report anomalies through a rich web interface while maintaining the robust scheduling backend.\n\n## Features\n\n### üé® Immersive Interface\n- **Three.js 3D Visualization**: Animated time spirals and particle effects\n- **Telegram UI Integration**: Native look and feel with theme support\n- **Haptic Feedback**: Enhanced tactile responses for temporal events\n- **Real-time Updates**: Live synchronization with the bot backend\n\n### ‚è∞ Temporal Management\n- **Visual Window Setup**: Intuitive time range configuration\n- **Global Sync Visualization**: Real-time countdown to œÄ-seeded moments\n- **Ping History Timeline**: Visual exploration of past anomalies\n- **Anomaly Reporting**: Rich media capture and geolocation\n\n### üîó Seamless Integration\n- **Bot Backend Compatibility**: Full integration with existing database\n- **Cross-Platform Support**: Works on all Telegram clients\n- **Secure Hosting**: Cloudflare Tunnel for safe self-hosting\n- **Zero-Trust Architecture**: No exposed ports or firewall configuration\n\n## Quick Start\n\n### Prerequisites\n\n1. **Python 3.8+** installed\n2. **Chronomancy bot** already set up and running\n3. **Domain name** (for Cloudflare Tunnel)\n4. **Cloudflare account** (free tier works)\n\n### Installation\n\n1. **Clone and navigate to Mini App**:\n   ```bash\n   cd chronomancy/miniapp\n   ```\n\n2. **Run the startup script**:\n   \n   **On Windows**:\n   ```cmd\n   start.bat\n   ```\n   \n   **On Linux/Mac**:\n   ```bash\n   ./start.sh\n   ```\n\n3. **Access locally** (for testing):\n   ```\n   http://localhost:5000\n   ```\n\n### Cloudflare Tunnel Setup\n\nFor secure public access without port forwarding:\n\n1. **Install cloudflared**:\n   ```bash\n   # Windows (using Chocolatey)\n   choco install cloudflared\n   \n   # Linux\n   wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\n   sudo dpkg -i cloudflared-linux-amd64.deb\n   \n   # macOS\n   brew install cloudflared\n   ```\n\n2. **Authenticate with Cloudflare**:\n   ```bash\n   cloudflared tunnel login\n   ```\n\n3. **Create tunnel**:\n   ```bash\n   cloudflared tunnel create chronomancy-miniapp\n   ```\n\n4. **Update configuration**:\n   Edit `cloudflare-tunnel.yml` with your tunnel credentials and domain.\n\n5. **Create DNS record**:\n   ```bash\n   cloudflared tunnel route dns chronomancy-miniapp chronomancy.yourdomain.com\n   ```\n\n6. **Restart the Mini App**:\n   The startup script will automatically detect and use the tunnel.\n\n## Telegram Bot Setup\n\nTo register your Mini App with Telegram:\n\n1. **Message @BotFather** in Telegram\n2. **Create or edit your bot**: `/mybots` ‚Üí Select your bot\n3. **Set Mini App URL**: \n   ```\n   Bot Settings ‚Üí Menu Button ‚Üí Configure Menu Button\n   ‚Üí Set URL: https://chronomancy.yourdomain.com\n   ```\n4. **Test the integration**: Open your bot and look for the menu button\n\n## Architecture\n\n### Frontend Stack\n- **HTML5/CSS3**: Responsive design with Telegram theme integration\n- **JavaScript ES6+**: Modern async/await patterns\n- **Three.js**: 3D graphics and animations\n- **Telegram WebApp SDK**: Native Mini App integration\n\n### Backend Stack\n- **FastAPI**: Modern async Python web framework for superior concurrency\n- **SQLite**: Shared database with existing bot\n- **Gunicorn**: Production WSGI server\n- **Cloudflare Tunnel**: Secure exposure without port forwarding\n\n### Data Flow\n```\nTelegram Mini App ‚Üê‚Üí Flask API ‚Üê‚Üí Bot Database\n                 ‚Üï\n           Cloudflare Tunnel\n                 ‚Üï\n            Internet Access\n```\n\n## API Endpoints\n\nThe Mini App provides a RESTful API for frontend communication:\n\n- `GET /api/user/settings` - Get user configuration\n- `POST /api/window/personal` - Set temporal window\n- `GET /api/pings/active` - Get scheduled pings\n- `GET /api/sync/global` - Get next global sync time\n- `POST /api/anomaly/report` - Submit anomaly report\n- `GET /api/anomaly/history` - Get user's anomaly timeline\n\n## Development\n\n### Local Development\n\n1. **Start in development mode**:\n   ```bash\n   export DEBUG=true\n   python server.py\n   ```\n\n2. **Access at**: `http://localhost:5000`\n\n3. **Mock data**: The app automatically uses mock API responses when not connected to Telegram\n\n### File Structure\n\n```\nminiapp/\n‚îú‚îÄ‚îÄ index.html              # Main Mini App page\n‚îú‚îÄ‚îÄ server.py              # Flask API server\n‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies\n‚îú‚îÄ‚îÄ start.sh              # Unix startup script\n‚îú‚îÄ‚îÄ start.bat             # Windows startup script\n‚îú‚îÄ‚îÄ cloudflare-tunnel.yml # Tunnel configuration\n‚îú‚îÄ‚îÄ js/\n‚îÇ   ‚îú‚îÄ‚îÄ telegram-init.js  # Telegram WebApp initialization\n‚îÇ   ‚îú‚îÄ‚îÄ three-scene.js    # 3D visualization engine\n‚îÇ   ‚îú‚îÄ‚îÄ api.js           # API communication layer\n‚îÇ   ‚îî‚îÄ‚îÄ app.js           # Main application logic\n‚îî‚îÄ‚îÄ README.md            # This file\n```\n\n## Customization\n\n### Visual Themes\nThe Mini App automatically adapts to Telegram's light/dark themes. You can customize colors in `index.html` CSS variables.\n\n### 3D Effects\nModify `js/three-scene.js` to customize:\n- Particle systems\n- Time spiral animations\n- Anomaly effects\n- Color schemes\n\n### API Integration\nExtend `server.py` to add new endpoints or modify data processing.\n\n## Troubleshooting\n\n### Common Issues\n\n**Database not found**:\n- Ensure the Telegram bot has been run at least once\n- Check path: `../bot/chronomancy.db`\n\n**Cloudflare tunnel not working**:\n- Verify `cloudflared` is installed and authenticated\n- Check tunnel configuration in `cloudflare-tunnel.yml`\n- Ensure DNS record is properly configured\n\n**Mini App not appearing in Telegram**:\n- Verify the menu button URL is set correctly in @BotFather\n- Check that your domain is accessible via HTTPS\n- Ensure the Mini App is running and responsive\n\n**API errors**:\n- Check Flask server logs for detailed error messages\n- Verify database permissions and connectivity\n- Ensure proper Telegram init data validation\n\n### Logs\n\n**Flask server logs**:\n```bash\n# Check server output for errors\ntail -f logs/server.log\n```\n\n**Cloudflare tunnel logs**:\n```bash\n# Monitor tunnel connectivity\ncloudflared tunnel --config cloudflare-tunnel.yml run --loglevel debug\n```\n\n## Security\n\n### Telegram Authentication\nThe Mini App validates Telegram init data to ensure users are authenticated through Telegram's secure channel.\n\n### Cloudflare Protection\n- DDoS protection\n- SSL/TLS encryption\n- Zero-trust networking\n- No exposed server ports\n\n### Data Privacy\n- All data stored locally in your SQLite database\n- No third-party analytics or tracking\n- Minimal data collection (only what's needed for functionality)\n\n## Performance\n\n### Optimization\n- **Three.js**: Optimized particle systems and geometry disposal\n- **API**: Efficient database queries with proper indexing\n- **Caching**: Static asset caching via Cloudflare CDN\n- **Compression**: Gzip compression for faster loading\n\n### Scaling\nFor high usage:\n- Increase Gunicorn workers: `--workers 4`\n- Add Redis for session management\n- Consider PostgreSQL for better concurrent access\n- Use Cloudflare Pro for enhanced performance\n\n## Contributing\n\nThe Chronomancy project follows the canonical principles outlined in `../canon.yaml`. All modifications should:\n\n1. **Preserve temporal mechanics**: Maintain œÄ-seeded deterministic algorithms\n2. **Enhance memetic efficiency**: Optimize for viral spread and user retention\n3. **Respect the editorial collective**: Cite justifications from the five canonical authors\n4. **Maintain zero-friction onboarding**: Any interface complexity must be invisible\n\n## License\n\nSee the main project license. This Mini App implementation is part of the Chronomancy temporal exploration initiative.\n\n---\n\n*\"The interface must be invisible to maximize temporal immersion\"* - Scott Wilber 